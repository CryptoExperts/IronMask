#!/bin/bash

EXEC="./ironmask"
TEST_PATH="../gadgets/Arith"
TEST_PATH_REF=$TEST_PATH"/refresh/nlogn"
TEST_PATH_ADD=$TEST_PATH"/add"
TEST_PATH_CPY=$TEST_PATH"/copy"
TEST_PATH_MULT=$TEST_PATH"/mult"
TEST_PATH_MULT_REF=$TEST_PATH"/mult-ref" 
TEST_PATH_FAIL=$TEST_PATH"/fail"

read -p "Press '1' for single core test, '2' for parallelized test : " para

CORES="-j $para"

NI_FILE="NI.txt"
SNI_FILE="SNI.txt"
RP_FILE="RP.txt"
RPC_FILE="RPC.txt"
CRPC_FILE="CRPC.txt"
RPE_FILE="RPE.txt"
TEST="python3 test.py print_test_"

declare -i CNT_PASS=0
declare -i CNT_FAIL=0

function update_cnt(){
  if [ $? -eq 0 ]
  then
    CNT_PASS=$(($CNT_PASS + 1))
  else 
    CNT_FAIL=$(($CNT_FAIL + 1))
  fi
}

start=$(date +%s)

echo "************** Checking Refresh Gadget **************"
echo

TEST_REF_1=$TEST_PATH_REF"/gadget_refresh_2_shares.sage"
TEST_REF_2=$TEST_PATH_REF"/gadget_refresh_3_shares.sage"
TEST_REF_3=$TEST_PATH_REF"/gadget_refresh_4_shares.sage"
TEST_REF_4=$TEST_PATH_REF"/gadget_refresh_5_shares.sage"

echo "Check '"$EXEC $TEST_REF_1 "cardRPC $CORES'"
$EXEC $TEST_REF_1 cardRPC $CORES |tail -n 29|head -n 26 > $CRPC_FILE
$TEST"CRPC" "tin = 0, tout = 0
 f(p) = [ 1, 3, 3, 1, 0, 0]

tin = 0, tout = 1
 f(p) = [ 1, 0, 0, 0, 0, 0]

tin = 0, tout = 2
 f(p) = [ 0, 0, 0, 0, 0, 0]

tin = 1, tout = 0
 f(p) = [ 0, 2, 6, 6, 2, 0]

tin = 1, tout = 1
 f(p) = [ 0, 5, 6, 4, 1, 0]

tin = 1, tout = 2
 f(p) = [ 0, 0, 0, 0, 0, 0]

tin = 2, tout = 0
 f(p) = [ 0, 0, 1, 3, 3, 1]

tin = 2, tout = 1
 f(p) = [ 0, 0, 4, 6, 4, 1]

tin = 2, tout = 2
 f(p) = [ 1, 5, 10, 10, 5, 1]
" $CRPC_FILE
update_cnt
echo 

echo "Check '"$EXEC $TEST_REF_2 "cardRPC -c 2 $CORES'"
$EXEC $TEST_REF_2 cardRPC -c 2 $CORES |tail -n 50|head -n 47 > $CRPC_FILE
$TEST"CRPC" "tin = 0, tout = 0
 f(p) = [ 1, 7, 21, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 1
 f(p) = [ 1, 6, 6, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 2
 f(p) = [ 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 3
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 0
 f(p) = [ 0, 3, 21, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 1
 f(p) = [ 0, 6, 33, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 2
 f(p) = [ 0, 9, 12, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 3
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 0
 f(p) = [ 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 1
 f(p) = [ 0, 0, 9, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 2
 f(p) = [ 0, 3, 35, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 3
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 0
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 1
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 2
 f(p) = [ 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 3
 f(p) = [ 1, 10, 45, 0, 0, 0, 0, 0, 0, 0, 0]
" $CRPC_FILE
update_cnt
echo 


echo "Check '"$EXEC $TEST_REF_3 "cardRPC $CORES'"
$EXEC $TEST_REF_3 cardRPC $CORES |tail -n 77|head -n 74 > $CRPC_FILE
$TEST"CRPC" "tin = 0, tout = 0
 f(p) = [ 1, 16, 106, 388, 891, 1376, 1488, 1152, 643, 256, 70, 12, 1, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 1
 f(p) = [ 1, 16, 94, 271, 455, 489, 353, 173, 56, 11, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 2
 f(p) = [ 1, 16, 82, 154, 163, 106, 43, 10, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 3
 f(p) = [ 1, 16, 22, 16, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 4
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 0
 f(p) = [ 0, 4, 76, 580, 2408, 6264, 11044, 13824, 12616, 8492, 4204, 1500, 368, 56, 4, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 1
 f(p) = [ 0, 4, 85, 622, 2207, 4682, 6663, 6796, 5154, 2956, 1283, 414, 95, 14, 1, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 2
 f(p) = [ 0, 4, 100, 472, 1132, 1766, 1980, 1644, 1006, 442, 132, 24, 2, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 3
 f(p) = [ 0, 4, 109, 256, 352, 320, 198, 80, 19, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 4
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 0
 f(p) = [ 0, 0, 8, 164, 1366, 6204, 17752, 34736, 48826, 50768, 39640, 23308, 10218, 3252, 712, 96, 6, 0, 0, 0, 0]

tin = 2, tout = 1
 f(p) = [ 0, 0, 11, 233, 1859, 7453, 18296, 30710, 37539, 34614, 24485, 13321, 5511, 1685, 360, 48, 3, 0, 0, 0, 0]

tin = 2, tout = 2
 f(p) = [ 0, 0, 25, 412, 2128, 6132, 11934, 17036, 18509, 15562, 10187, 5180, 2022, 590, 122, 16, 1, 0, 0, 0, 0]

tin = 2, tout = 3
 f(p) = [ 0, 0, 40, 517, 1746, 3594, 5187, 5551, 4506, 2788, 1300, 443, 104, 15, 1, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 4
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 0
 f(p) = [ 0, 0, 0, 8, 176, 1572, 7676, 23756, 50688, 78456, 90868, 80136, 54168, 27964, 10860, 3076, 600, 72, 4, 0, 0]

tin = 3, tout = 1
 f(p) = [ 0, 0, 0, 14, 314, 2672, 11713, 31980, 60409, 83846, 88505, 72330, 46024, 22684, 8515, 2356, 453, 54, 3, 0, 0]

tin = 3, tout = 2
 f(p) = [ 0, 0, 6, 132, 1220, 5830, 17640, 37724, 60436, 74820, 72754, 55946, 33988, 16166, 5906, 1602, 304, 36, 2, 0, 0]

tin = 3, tout = 3
 f(p) = [ 0, 0, 15, 270, 1994, 7508, 18754, 34266, 48099, 53278, 47231, 33680, 19267, 8748, 3088, 818, 153, 18, 1, 0, 0]

tin = 3, tout = 4
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 4, tout = 0
 f(p) = [ 0, 0, 0, 0, 4, 88, 800, 4052, 13197, 29988, 49974, 63004, 61215, 46248, 27184, 12332, 4239, 1068, 186, 20, 1]

tin = 4, tout = 1
 f(p) = [ 0, 0, 0, 0, 10, 208, 1735, 7861, 22812, 46533, 70482, 81895, 74340, 53137, 29884, 13100, 4389, 1086, 187, 20, 1]

tin = 4, tout = 2
 f(p) = [ 0, 0, 1, 24, 263, 1708, 7176, 21108, 46018, 77136, 101683, 106810, 89958, 60764, 32732, 13886, 4540, 1104, 188, 20, 1]

tin = 4, tout = 3
 f(p) = [ 0, 0, 4, 81, 747, 4081, 14621, 37623, 73346, 111892, 136225, 133837, 106599, 68757, 35671, 14686, 4692, 1122, 189, 20, 1]

tin = 4, tout = 4
 f(p) = [ 1, 20, 190, 1140, 4845, 15504, 38760, 77520, 125970, 167960, 184756, 167960, 125970, 77520, 38760, 15504, 4845, 1140, 190, 20, 1]
" $CRPC_FILE
update_cnt
echo 

echo "Check '"$EXEC $TEST_REF_4 "cardRPC $CORES'"
$EXEC $TEST_REF_4 cardRPC $CORES |tail -n 110|head -n 107 > $CRPC_FILE
$TEST"CRPC" "tin = 0, tout = 0
 f(p) = [ 1, 20, 177, 917, 3120, 7466, 13168, 17692, 18510, 15262, 9941, 5079, 2000, 588, 122, 16, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 1
 f(p) = [ 1, 20, 168, 770, 2151, 3976, 5149, 4838, 3352, 1712, 633, 162, 26, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 2
 f(p) = [ 1, 20, 159, 614, 1254, 1596, 1360, 800, 324, 87, 14, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 3
 f(p) = [ 1, 20, 128, 271, 329, 257, 135, 47, 10, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 4
 f(p) = [ 1, 19, 29, 23, 10, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 0, tout = 5
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 0
 f(p) = [ 0, 5, 112, 1101, 6299, 23576, 61988, 120222, 177970, 205796, 188496, 137551, 79823, 36478, 12872, 3390, 628, 73, 4, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 1
 f(p) = [ 0, 6, 136, 1180, 5444, 15722, 31220, 45278, 50003, 43303, 29970, 16716, 7488, 2648, 714, 138, 17, 1, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 2
 f(p) = [ 0, 6, 145, 1225, 4835, 11333, 17960, 20714, 18106, 12214, 6363, 2520, 733, 147, 18, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 3
 f(p) = [ 0, 6, 160, 742, 1711, 2530, 2675, 2098, 1216, 507, 144, 25, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 4
 f(p) = [ 0, 6, 169, 373, 475, 403, 234, 89, 20, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 1, tout = 5
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 0
 f(p) = [ 0, 0, 11, 269, 2882, 17932, 72827, 207637, 437040, 703524, 887347, 890575, 717016, 463808, 239861, 97971, 30928, 7280, 1202, 124, 6, 0, 0, 0, 0, 0]

tin = 2, tout = 1
 f(p) = [ 0, 0, 21, 493, 4603, 23319, 75260, 169922, 284774, 368366, 377193, 310225, 206055, 110207, 46922, 15564, 3880, 684, 76, 4, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 2
 f(p) = [ 0, 0, 30, 673, 5572, 23430, 61608, 114013, 159374, 175647, 156511, 114220, 68520, 33646, 13360, 4197, 1006, 173, 19, 1, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 3
 f(p) = [ 0, 0, 46, 854, 4520, 13206, 26256, 38942, 44940, 41163, 30182, 17710, 8236, 2972, 802, 152, 18, 1, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 4
 f(p) = [ 0, 0, 61, 938, 3079, 6146, 8726, 9318, 7641, 4820, 2304, 807, 195, 29, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 2, tout = 5
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 0
 f(p) = [ 0, 0, 0, 13, 341, 3930, 26296, 114647, 350651, 792164, 1370728, 1862997, 2022179, 1770156, 1254492, 718585, 330245, 120056, 33728, 7054, 1032, 94, 4, 0, 0, 0]

tin = 3, tout = 1
 f(p) = [ 0, 0, 1, 59, 1127, 10315, 54392, 187910, 461920, 852654, 1224687, 1400609, 1292897, 969205, 589782, 289388, 112938, 34268, 7794, 1250, 126, 6, 0, 0, 0, 0]

tin = 3, tout = 2
 f(p) = [ 0, 0, 4, 143, 2169, 16738, 74350, 217937, 461812, 749064, 963333, 1003028, 855032, 599145, 344458, 161239, 60580, 17850, 3975, 629, 63, 3, 0, 0, 0, 0]

tin = 3, tout = 3
 f(p) = [ 0, 0, 17, 399, 4040, 20736, 67671, 158754, 285882, 409880, 478044, 459324, 365931, 242035, 132455, 59470, 21588, 6190, 1351, 211, 21, 1, 0, 0, 0, 0]

tin = 3, tout = 4
 f(p) = [ 0, 0, 32, 585, 4702, 18015, 45711, 85846, 125708, 147546, 140784, 109765, 69799, 35905, 14718, 4694, 1122, 189, 20, 1, 0, 0, 0, 0, 0, 0]

tin = 3, tout = 5
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 4, tout = 0
 f(p) = [ 0, 0, 0, 0, 8, 224, 2761, 19713, 91437, 297068, 712716, 1310660, 1896104, 2196102, 2058789, 1570759, 975842, 491526, 198798, 63520, 15632, 2848, 360, 28, 1, 0]

tin = 4, tout = 1
 f(p) = [ 0, 0, 0, 2, 86, 1446, 12755, 68181, 245462, 639332, 1264130, 1960006, 2434612, 2455216, 2024199, 1366483, 752766, 335478, 119160, 32948, 6834, 1000, 92, 4, 0, 0]

tin = 4, tout = 2
 f(p) = [ 0, 0, 0, 8, 254, 3458, 25760, 117991, 369457, 851481, 1515763, 2149500, 2475448, 2341238, 1828019, 1178661, 624877, 269872, 93491, 25363, 5190, 753, 69, 3, 0, 0]

tin = 4, tout = 3
 f(p) = [ 0, 0, 6, 157, 1869, 13302, 61637, 202500, 502146, 979033, 1540584, 1989574, 2130580, 1902283, 1418147, 880749, 452915, 190823, 64805, 17309, 3501, 504, 46, 2, 0, 0]

tin = 4, tout = 4
 f(p) = [ 0, 1, 32, 484, 4290, 24720, 98267, 291043, 674768, 1264175, 1953949, 2525389, 2752531, 2541955, 1992091, 1322981, 741283, 347700, 134900, 42540, 10628, 2024, 276, 24, 1, 0]

tin = 4, tout = 5
 f(p) = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]

tin = 5, tout = 0
 f(p) = [ 0, 0, 0, 0, 0, 2, 60, 789, 5967, 29161, 99532, 250538, 483178, 733168, 891264, 878039, 705331, 462640, 246968, 106402, 36460, 9708, 1936, 272, 24, 1]

tin = 5, tout = 1
 f(p) = [ 0, 0, 0, 0, 2, 64, 905, 7335, 38215, 138827, 372642, 769820, 1259246, 1663024, 1795783, 1597187, 1173374, 711144, 353670, 142898, 46170, 11644, 2208, 296, 25, 1]

tin = 5, tout = 2
 f(p) = [ 0, 0, 0, 0, 8, 214, 2560, 17853, 81153, 261130, 630667, 1189838, 1801111, 2226243, 2271561, 1924663, 1356512, 793680, 383215, 151107, 47877, 11894, 2231, 297, 25, 1]

tin = 5, tout = 3
 f(p) = [ 0, 0, 1, 29, 393, 3282, 18830, 78398, 247390, 612392, 1219806, 1990767, 2695551, 3053010, 2905996, 2328389, 1568454, 884561, 414544, 159580, 49608, 12145, 2254, 298, 25, 1]

tin = 5, tout = 4
 f(p) = [ 0, 0, 4, 101, 1195, 8744, 44136, 163103, 462939, 1044208, 1916890, 2911692, 3701061, 3965273, 3594851, 2760460, 1792278, 979351, 446844, 168224, 51358, 12397, 2277, 299, 25, 1]

tin = 5, tout = 5
 f(p) = [ 1, 25, 300, 2300, 12650, 53130, 177100, 480700, 1081575, 2042975, 3268760, 4457400, 5200300, 5200300, 4457400, 3268760, 2042975, 1081575, 480700, 177100, 53130, 12650, 2300, 300, 25, 1]
 " $CRPC_FILE
update_cnt
echo 


echo "************** Checking Addition Gadget **************"
echo

TEST_ADD_1=$TEST_PATH_ADD"/gadget_add_3_shares.sage"
TEST_ADD_2=$TEST_PATH_ADD"/gadget_add_4_shares.sage"

echo "Check '"$EXEC $TEST_ADD_1 "NI -t 2 $CORES'"
$EXEC $TEST_ADD_1 NI -t 2 $CORES |head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 2-NI." $NI_FILE
update_cnt
echo 

echo "Check '"$EXEC $TEST_ADD_1 "NI -t 3 $CORES'"
$EXEC $TEST_ADD_1 NI -t 3 $CORES |head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 3-NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_2 "NI -t 3 $CORES'"
$EXEC $TEST_ADD_2 NI -t 3 $CORES|head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 3-NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_1 "RP -c 7 $CORES'"
$EXEC $TEST_ADD_1 RP -c 7 $CORES|head -n 11 |tail -n 1 |cut -c -35 > $RP_FILE
$TEST"NI" "[ 0, 0, 8, 324, 6166, 73204, 608984" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_2 "RP -c 5 $CORES'"
$EXEC $TEST_ADD_2 RP -c 5 $CORES|head -n 11 |tail -n 1 |cut -c -19 > $RP_FILE
$TEST"NI" "[ 0, 0, 0, 16, 1216" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_1 "RPC -c 5 -t 2 $CORES"
$EXEC $TEST_ADD_1 RPC -c 5 -t 2 $CORES |head -n 11 |tail -n 1 > $RPC_FILE
$TEST"NI" "f(p) = [0, 0, 1, 88, 2460, 37400, 67436, 67864, 44190, 20476, 6760, 1590, 240, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_2 "RPC -c 4 -t 1 $CORES'"
$EXEC $TEST_ADD_2 RPC -c 4 -t 1 $CORES |head -n 11 |tail -n 1 > $RPC_FILE
$TEST"NI" "f(p) = [0, 0, 14, 1002, 35281, 40932, 25350, 7848, 1308, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_2 "RPC -c 4 -t 3 $CORES'"
$EXEC $TEST_ADD_2 RPC -c 4 -t 3 $CORES|head -n 11 |tail -n 1 > $RPC_FILE
$TEST"NI" "f(p) = [0, 0, 1, 74, 2870, 3290, 2127, 744, 169, 18, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_ADD_1 "RPE -c 3 -t 2 $CORES'"
$EXEC $TEST_ADD_1 RPE -c 3 -t 2 $CORES |head -n 21 |tail -n 10 > $RPE_FILE
$TEST"RPE" "REP1- I1: [0, 0, 1, 64, 48, 25, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I2: [0, 0, 1, 64, 48, 25, 6, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I1_and_I2: [0, 0, 1, 40, 24, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" "REP2- I1: [0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I2: [0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I1_and_I2: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo 

echo "Check '"$EXEC $TEST_ADD_2 "RPE -c 4 -t 1 $CORES'"
$EXEC $TEST_ADD_2 RPE -c 4 -t 1 $CORES |head -n 21 |tail -n 10 > $RPE_FILE
$TEST"RPE" "REP1- I1: [0, 0, 7, 501, 17665, 20466, 12675, 3924, 654, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I2: [0, 0, 7, 501, 17665, 20466, 12675, 3924, 654, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I1_and_I2: [0, 0, 0, 0, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" "REP2- I1: [0, 0, 7, 501, 17658, 20472, 12686, 3930, 655, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I2: [0, 0, 7, 501, 17658, 20472, 12686, 3930, 655, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I1_and_I2: [0, 0, 0, 0, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo 

echo "************** Checking Copy Gadget **************"
echo

TEST_CPY_1=$TEST_PATH_CPY"/gadget_copy_3_shares.sage"
TEST_CPY_2=$TEST_PATH_CPY"/gadget_copy_4_shares.sage"

echo "Check '"$EXEC $TEST_CPY_1 "NI -t 2 $CORES'"
$EXEC $TEST_CPY_1 NI -t 2 $CORES |head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 2-NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_1 "NI -t 3 $CORES'"
$EXEC $TEST_CPY_1 NI -t 3 |head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 3-NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_1 "RP -c 7 $CORES'"
$EXEC $TEST_CPY_1 RP -c 7 $CORES |head -n 11 |tail -n 1 > $RP_FILE
$TEST"NI" "[ 0, 0, 33, 1077, 16073, 147033, 933425, 3200627, 6850620, 10166528, 11140068, 9362095, 6173063, 3232923, 1350123, 447825, 116428, 23105, 3330, 315, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_2 "RP -c 6 $CORES'"
$EXEC $TEST_CPY_2 RP -c 6 $CORES|head -n 11|tail -n 1 > $RP_FILE
$TEST"NI" "[ 0, 0, 0, 111, 7248, 230677, 975654, 2151416, 3104838, 3210019, 2481544, 1463121, 661056, 226962, 57792, 10386, 1188, 66, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_1 "RPC -c 3 -t 1 $CORES'"
$EXEC $TEST_CPY_1 RPC -c 3 -t 1 $CORES|head -n 11 |tail -n 1 > $RPC_FILE
$TEST"NI" "f(p) = [0, 0, 36, 1160, 2684, 3012, 1980, 802, 189, 21, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_2 "RPC -c 4 -t 2 $CORES'"
$EXEC $TEST_CPY_2 RPC -c 4 -t 2 $CORES |head -n 11 |tail -n 1 > $RPC_FILE
$TEST"NI" "f(p) = [0, 0, 1, 227, 12417, 33996, 48513, 44096, 27395, 11722, 3360, 588, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_1 "RPE -c 5 -t 2 $CORES'"
$EXEC $TEST_CPY_1 RPE -c 5 -t 2 $CORES |head -n 22 |tail -n 11 > $RPE_FILE
$TEST"RPE_COPY" "REP11 : [0, 0, 8, 377, 7857, 89674, 290646, 508176, 575606, 457332, 264127, 112023, 34471, 7393, 1005, 67, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP12 : [0, 0, 4, 205, 4316, 50333, 162278, 281367, 315725, 248415, 142072, 59692, 18212, 3879, 525, 35, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP21 : [0, 0, 4, 205, 4316, 50333, 162278, 281367, 315725, 248415, 142072, 59692, 18212, 3879, 525, 35, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP22 : [0, 0, 0, 33, 1077, 16073, 55032, 99464, 115786, 94296, 55704, 24108, 7548, 1641, 225, 15, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_1 "RPE -c 6 -t 1 $CORES'"
$EXEC $TEST_CPY_1 RPE -c 6 -t 1 $CORES |head -n 22 |tail -n 11 > $RPE_FILE
$TEST"RPE_COPY" "REP11 : [0, 0, 43, 1421, 19842, 161244, 902958, 2716437, 5069315, 6524506, 6115608, 4320878, 2342582, 979616, 313804, 75325, 12935, 1440, 80, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP12 : [0, 0, 36, 1439, 21516, 174342, 957367, 2861337, 5331944, 6836275, 6393331, 4509988, 2441937, 1019932, 326338, 78250, 13426, 1494, 83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP21 : [0, 0, 36, 1439, 21516, 174342, 957367, 2861337, 5331944, 6836275, 6393331, 4509988, 2441937, 1019932, 326338, 78250, 13426, 1494, 83, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP22 : [0, 0, 29, 1457, 23501, 186141, 994348, 2940336, 5454915, 6978944, 6518265, 4593290, 2484411, 1036473, 331219, 79323, 13596, 1512, 84, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_CPY_2 "RPE -c 4 -t 3 $CORES'"
$EXEC $TEST_CPY_2 RPE -c 4 -t 3 $CORES |head -n 22 |tail -n 11 > $RPE_FILE
$TEST"RPE_COPY" "REP11 : [0, 0, 8, 524, 17323, 37974, 41153, 26636, 11022, 2862, 444, 36, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP12 : [0, 0, 4, 262, 8725, 19185, 20899, 13651, 5742, 1539, 255, 24, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP21 : [0, 0, 4, 262, 8725, 19185, 20899, 13651, 5742, 1539, 255, 24, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP22 : [0, 0, 0, 0, 111, 372, 628, 660, 461, 216, 66, 12, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo
 
echo "Check '"$EXEC $TEST_CPY_2 "RPE -c 3 -t 4 $CORES'"
$EXEC $TEST_CPY_2 RPE -c 3 -t 4 $CORES|head -n 22 |tail -n 11 > $RPE_FILE
$TEST"RPE_COPY" "REP11 : [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP12 : [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP21 : [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP22 : [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

echo "************** Checking Multiplication Gadget without Refresh **************"
echo

TEST_MULT_1=$TEST_PATH_MULT"/gadget_mult_3_shares.sage"
TEST_MULT_2=$TEST_PATH_MULT"/gadget_mult_4_shares.sage"

echo "Check '"$EXEC $TEST_MULT_1 "NI -t 2 $CORES'"
$EXEC $TEST_MULT_1 NI -t 2 $CORES |head -n 10 |tail -n 1 > $NI_FILE
$TEST"NI" "Gadget is 2-NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_1 "SNI -t 2 $CORES'"
$EXEC $TEST_MULT_1 SNI -t 2 $CORES 2>/dev/null |head -n 10 |tail -n 1 >$SNI_FILE
$TEST"NI" "Gadget is 2-SNI." $SNI_FILE
update_cnt
echo


echo "Check '"$EXEC $TEST_MULT_1 "RP -c 4 $CORES'"
$EXEC $TEST_MULT_1 RP -c 4 $CORES |head -n 11 |tail -n 1 |cut -c -19 >$RP_FILE
$TEST"NI" "[ 0, 0, 1297, 58874" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_2 "RP -c 4 $CORES'"
$EXEC $TEST_MULT_2 RP -c 4 $CORES |head -n 11 |tail -n 1 > $RP_FILE
$TEST"NI" "[ 0, 0, 0, 37616, 261501, 1120722, 3542393, 8946853, 18804625, 33662029, 52056872, 70162009, 82836190, 85874100, 78186094, 62419814, 43551954, 26427118, 13854680, 6222762, 2368744, 753512, 196560, 40950, 6552, 756, 56, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_1 "RPC -c 4 -t 1 $CORES'"
$EXEC $TEST_MULT_1 RPC -c 4 -t 1 $CORES |head -n 11 |tail -n 1 |cut -c -32 >$RPC_FILE
$TEST"NI" "f(p) = [0, 0, 415, 17546, 330916" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_1 "RPC -c 3 -t 2 $CORES'"
$EXEC $TEST_MULT_1 RPC -c 3 -t 2  $CORES |head -n 11 |tail -n 1 |cut -c -22 >$RPC_FILE
$TEST"NI" "f(p) = [0, 0, 64, 4834" $RPC_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_2 "RPC -c 3 -t 3 $CORES'"
$EXEC $TEST_MULT_2 RPC -c 3 -t 3  $CORES |head -n 11 |tail -n 1 >$RPC_FILE
$TEST"NI" "f(p) = [0, 0, 6, 1071, 2071, 2907, 2988, 2223, 1138, 386, 80, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPC_FILE
update_cnt
echo

echo "Check'"$EXEC $TEST_MULT_2 "RPE -c 3 -t 1 $CORES'"
$EXEC $TEST_MULT_2 RPE -c 3 -t 1  $CORES|head -n 21 |tail -n 10 > $RPE_FILE
$TEST"RPE" "REP1- I1: [0, 0, 758, 65294, 326710, 1065882, 2564492, 4894153, 7686092, 10120840, 11282696, 10688885, 8590946, 5818932, 3285918, 1524696, 570384, 167616, 37240, 5880, 588, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I2: [0, 0, 762, 65608, 327202, 1066606, 2565192, 4894573, 7686232, 10120860, 11282696, 10688885, 8590946, 5818932, 3285918, 1524696, 570384, 167616, 37240, 5880, 588, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I1_and_I2: [0, 0, 104, 19410, 68587, 176136, 327341, 462460, 508685, 436781, 289088, 144224, 52416, 13104, 2016, 144, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" "REP2- I1: [0, 0, 763, 66484, 328600, 1068244, 2566501, 4895276, 7686453, 10120891, 11282696, 10688885, 8590946, 5818932, 3285918, 1524696, 570384, 167616, 37240, 5880, 588, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I2: [0, 0, 767, 66873, 329194, 1069038, 2567225, 4895700, 7686593, 10120911, 11282696, 10688885, 8590946, 5818932, 3285918, 1524696, 570384, 167616, 37240, 5880, 588, 28, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I1_and_I2: [0, 0, 109, 20528, 70288, 178183, 329035, 463394, 508983, 436823, 289088, 144224, 52416, 13104, 2016, 144, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

echo "Check'"$EXEC $TEST_MULT_1 "RPE -c 3 -t 2 $CORES'"
$EXEC $TEST_MULT_1 RPE -c 3 -t 2 $CORES|head -n 21 |tail -n 10 > $RPE_FILE
$TEST"RPE" "REP1- I1: [0, 0, 46, 3261, 8735, 14024, 15861, 13872, 9988, 6156, 3233, 1387, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I2: [0, 0, 64, 4020, 10129, 15650, 17012, 14374, 10116, 6172, 3233, 1387, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I1_and_I2: [0, 0, 46, 2447, 6060, 8646, 8149, 5304, 2373, 712, 132, 12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" "REP2- I1: [0, 0, 0, 1185, 3407, 6267, 8467, 9035, 7818, 5504, 3112, 1376, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I2: [0, 0, 18, 2229, 5276, 8384, 9952, 9688, 7986, 5525, 3112, 1376, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I1_and_I2: [0, 0, 0, 182, 231, 149, 48, 8, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

echo "************** Checking Multiplication Gadget with Refresh **************"
echo

TEST_MULT_REF_1=$TEST_PATH_MULT_REF"/gadget_mult_ref_2_shares.sage"
TEST_MULT_REF_2=$TEST_PATH_MULT_REF"/gadget_mult_ref_3_shares.sage"
TEST_MULT_REF_3=$TEST_PATH_MULT_REF"/gadget_mult_ref_4_shares.sage"

echo "Check'"$EXEC $TEST_MULT_REF_2 "NI -t 2 $CORES'"
$EXEC $TEST_MULT_REF_2 NI -t 2 $CORES |head -n 10 |tail -n 1 |cut -c -17 >$NI_FILE
$TEST"NI" "Gadget is not NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_REF_3 "NI -t 1 $CORES'"
$EXEC $TEST_MULT_REF_3 NI -t 1 $CORES |head -n 10 |tail -n 1 |cut -c -17 >$NI_FILE
$TEST"NI" "Gadget is not NI." $NI_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_REF_3 "RP -c 4 $CORES'"
$EXEC $TEST_MULT_REF_3 RP -c 4 $CORES|head -n 11 |tail -n 1 > $RP_FILE
$TEST"NI" "[ 0, 4, 976, 135728, 396664, 1117624, 2977172, 7223802, 15458972, 28718540, 46153384, 64328410, 78030792, 82577068, 76313552, 61549150, 43226064, 26331340, 13833400, 6219402, 2368408, 753496, 196560, 40950, 6552, 756, 56, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_REF_2 "RP -c 5 $CORES'"
$EXEC $TEST_MULT_REF_2 RP -c 5 $CORES|head -n 11 |tail -n 1 > $RP_FILE
$TEST"NI" "[ 0, 3, 1069, 109407, 6260007, 29266523, 84012360, 175214019, 284819843, 374288970, 406617885, 370568359, 286076919, 188228040, 105889388, 50956212, 20928807, 7298622, 2142651, 522642, 103845, 16284, 1908, 150, 6, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ]" $RP_FILE
update_cnt
echo

echo "Check '"$EXEC $TEST_MULT_REF_2 "RPE -c 3 -t 2 $CORES'"
$EXEC $TEST_MULT_REF_2 RPE -c 3 -t 2 $CORES |head -n 21 |tail -n 11 > $RPE_FILE
$TEST"RPE" "REP1- I1: [1, 132, 8646, 374660, 929739, 1390746, 1466525, 1178856, 746433, 378890, 154263, 49998, 12610, 2370, 300, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I2: [0, 8, 1031, 65903, 185812, 318380, 380733, 342947, 241374, 134964, 60038, 21093, 5720, 1140, 150, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP1- I1_and_I2: [0, 8, 1031, 65903, 185812, 318380, 380733, 342947, 241374, 134964, 60038, 21093, 5720, 1140, 150, 10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" "REP2- I1: [1, 132, 8646, 374660, 929739, 1390746, 1466525, 1178856, 746433, 378890, 154263, 49998, 12610, 2370, 300, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I2: [0, 0, 0, 512, 1920, 4320, 6760, 7992, 7380, 5380, 3090, 1374, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
REP2- I1_and_I2: [0, 0, 0, 512, 1920, 4320, 6760, 7992, 7380, 5380, 3090, 1374, 455, 105, 15, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]" $RPE_FILE
update_cnt
echo

end=$(date +%s)

echo "***************************** End of the test *****************************"
echo "Number of test passed : "$CNT_PASS
echo "Number of test failed : "$CNT_FAIL
echo "Time : $((end - start)) secondes"

rm $NI_FILE
rm $SNI_FILE
rm $RPE_FILE
rm $RPC_FILE
rm $RP_FILE
rm $CRPC_FILE




